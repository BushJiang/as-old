# 产品需求文档 (PRD)

**项目名称**: 如故（as old）
**版本**: 0.1.0
**创建日期**: 2025-12-24
**负责人**: 江浩

## 1. 产品概述

### 1.1 产品信息

**名称**: 如故（as old）
**标语**: 帮助内向者找到一见如故的朋友
**版本**: 0.1.0

**产品描述**:
如故是一个专为内向者设计的社交匹配应用。应用通过存储用户资料，利用向量数据库和AI技术分析用户的需求、供给、兴趣爱好等维度，为用户精准匹配一见如故的朋友，并提供个性化的破冰话题，打破社交壁垒。

**目标用户**:
- 主要用户群体：想认识新朋友但难以主动连接他人的内向者
- 次要用户群体：希望拓展高质量社交圈的用户
- 管理员用户：负责系统维护和用户管理

**核心价值主张**:
1. 精准匹配：通过AI分析用户多维度信息，找到真正匹配的朋友
2. 降低社交门槛：提供破冰话题，减少主动沟通的压力
3. 保护隐私：严格遵守隐私设置，确保信息安全
4. 智能推荐：基于向量相似度持续优化匹配质量

### 1.2 问题与解决方案

**用户痛点**:
- 内向者难以主动发起社交互动
- 缺乏有效的社交匹配机制
- 不知道如何与陌生人开启对话
- 担心个人隐私和信息安全

**解决方案**:
- AI驱动的多维度匹配算法
- 个性化破冰话题生成
- 隐私保护机制
- 渐进式社交体验设计

## 2. 功能需求

### 2.1 认证功能 (P0)

**功能ID**: AUTH-001
**功能名称**: 用户注册与登录
**优先级**: P0
**描述**: 允许用户创建账户并安全登录系统

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 用户可以使用邮箱和密码注册账户 | |
| REQ-002 | 用户可以使用注册的邮箱和密码登录 | |
| REQ-003 | 支持密码重置功能 | 通过邮箱验证 |
| REQ-004 | 登录状态保持（7天免登录） | 使用安全的session机制 |
| REQ-005 | 支持登出功能 | 清除登录状态 |

#### 约束
- 密码必须使用bcrypt或Argon2加密存储（参考real.md约束1）
- 敏感信息必须加密存储和传输（参考real.md约束2）

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 用户可以使用邮箱和密码注册账户 | 关键 |
| AC-2 | 密码使用bcrypt哈希存储 | 关键 |
| AC-3 | 重复邮箱注册显示清晰错误信息 | 关键 |
| AC-4 | 登录后跳转到主页 | 关键 |
| AC-5 | 密码重置邮件发送到注册邮箱 | 关键 |
| AC-6 | 未登录用户访问需登录页面自动跳转登录 | 高 |

### 2.2 用户资料管理 (P0)

**功能ID**: PROFILE-001
**功能名称**: 用户资料管理
**优先级**: P0
**描述**: 允许用户创建和编辑个人资料，包括基本信息、兴趣爱好、需求和供给

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 用户可以填写基本信息（姓名、年龄、城市等） | 必填项 |
| REQ-002 | 用户可以添加多个兴趣爱好 | 文本描述 |
| REQ-003 | 用户可以描述自己的需求 | 文本描述 |
| REQ-004 | 用户可以描述自己能提供的内容 | 文本描述 |
| REQ-005 | 用户可以上传头像 | 支持JPG/PNG，最大2MB |
| REQ-006 | 用户可以设置隐私偏好 | 公开/仅匹配可见/完全私密 |
| REQ-007 | 用户可以随时编辑资料 | 修改后需要重新生成嵌入向量 |

#### 约束
- 用户个人资料、兴趣爱好等敏感信息必须加密存储和传输（参考real.md约束2）
- 匹配推荐算法必须考虑用户隐私设置（参考real.md约束3）

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 用户可以完整填写所有资料字段 | 关键 |
| AC-2 | 头像上传成功并显示在资料页 | 关键 |
| AC-3 | 资料修改后更新嵌入向量 | 关键 |
| AC-4 | 隐私设置生效，匹配时按设置展示 | 关键 |
| AC-5 | 必填字段未填写时显示验证提示 | 高 |

### 2.3 AI匹配功能 (P0)

**功能ID**: MATCH-001
**功能名称**: 智能匹配推荐
**优先级**: P0
**描述**: 基于向量数据库和AI算法，为用户推荐匹配的朋友

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 系统自动计算用户与其他用户的匹配度 | 使用向量相似度 |
| REQ-002 | 为用户推荐匹配度最高的前10位用户 | 按匹配度排序 |
| REQ-003 | 显示匹配度百分比和匹配原因 | 基于共同兴趣/需求等 |
| REQ-004 | 支持刷新匹配推荐 | 重新计算相似度 |
| REQ-005 | 避免推荐已拒绝的用户 | |
| REQ-006 | 匹配推荐考虑隐私设置 | 未授权不得公开匹配信息 |

#### 约束
- 匹配推荐算法必须考虑用户隐私设置（参考real.md约束3）
- 向量数据库中的用户嵌入向量必须定期更新和验证准确性（参考real.md约束4）

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 用户打开匹配页看到推荐列表 | 关键 |
| AC-2 | 推荐列表按匹配度从高到低排序 | 关键 |
| AC-3 | 匹配度计算准确（80%以上准确率） | 关键 |
| AC-4 | 匹配原因清晰展示（共同兴趣/需求） | 高 |
| AC-5 | 隐私设置生效，私密用户不显示在推荐中 | 关键 |

### 2.4 破冰话题生成 (P0)

**功能ID**: ICEBREAKER-001
**功能名称**: 破冰话题生成
**优先级**: P0
**描述**: 基于匹配用户的信息，AI生成个性化的破冰话题

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 点击匹配用户时自动生成3-5个破冰话题 | 基于双方资料生成 |
| REQ-002 | 话题类型包括：兴趣话题、经历话题、价值观话题、轻松话题 | 多样化话题 |
| REQ-003 | 支持重新生成话题 | 如果对话题不满意 |
| REQ-004 | 用户可以将喜欢的话题保存 | 收藏功能 |
| REQ-005 | 话题内容友好、安全，无不当内容 | AI内容审核 |

#### 约束
- 敏感信息保护，破冰话题不得泄露私密信息（参考real.md约束2）

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 选择匹配用户后显示破冰话题列表 | 关键 |
| AC-2 | 每个话题都有明确的指向性 | 关键 |
| AC-3 | 话题内容个性化，与双方信息相关 | 关键 |
| AC-4 | 重新生成功能正常，话题内容不同 | 高 |
| AC-5 | 话题内容安全，无不当内容 | 关键 |

### 2.5 匹配管理 (P1)

**功能ID**: MATCH-002
**功能名称**: 匹配关系管理
**优先级**: P1
**描述**: 管理用户之间的匹配关系，包括确认匹配、拒绝匹配等

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 用户可以对推荐用户表示感兴趣或拒绝 | 滑动操作或按钮 |
| REQ-002 | 双方都表示感兴趣时显示匹配成功 | 通知双方 |
| REQ-003 | 匹配成功后显示联系方式或聊天入口 | 可选 |
| REQ-004 | 匹配历史记录可查看 | 包含匹配度、时间等 |
| REQ-005 | 支持屏蔽用户 | 屏蔽后将不再推荐 |

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 用户可以对推荐进行感兴趣/拒绝操作 | 关键 |
| AC-2 | 双方感兴趣时匹配成功通知 | 关键 |
| AC-3 | 匹配历史正确显示 | 高 |
| AC-4 | 屏蔽功能生效 | 高 |

### 2.6 用户设置 (P1)

**功能ID**: SETTING-001
**功能名称**: 用户设置与偏好
**优先级**: P1
**描述**: 用户可以自定义应用设置和匹配偏好

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 用户可以设置匹配偏好（年龄段、距离等） | |
| REQ-002 | 用户可以设置通知偏好 | 邮件、推送通知 |
| REQ-003 | 用户可以修改密码 | 需验证原密码 |
| REQ-004 | 用户可以注销账户 | 软删除，保留30天 |
| REQ-005 | 用户可以导出个人数据 | GDPR合规 |

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 匹配偏好设置生效 | 高 |
| AC-2 | 通知设置正确应用 | 高 |
| AC-3 | 密码修改功能正常 | 关键 |
| AC-4 | 账户注销功能正常 | 高 |

### 2.7 数据统计 (P2)

**功能ID**: ANALYTICS-001
**功能名称**: 匹配数据统计
**优先级**: P2
**描述**: 为用户提供匹配数据分析

#### 需求

| ID | 需求 | 备注 |
|----|------|------|
| REQ-001 | 显示匹配次数和成功率 | 图表展示 |
| REQ-002 | 显示最匹配的特质 | 基于历史数据 |
| REQ-003 | 展示匹配趋势 | 时间轴视图 |
| REQ-004 | 提供优化建议 | 基于数据生成 |

#### 验收标准

| ID | 标准 | 优先级 |
|----|------|--------|
| AC-1 | 数据统计准确 | 中 |
| AC-2 | 图表正确显示 | 中 |
| AC-3 | 优化建议合理 | 中 |

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 目标 | 测量方式 |
|------|------|----------|
| 页面加载 | < 3秒 | 首次内容绘制 |
| 匹配计算 | < 2秒 | API响应时间 |
| 向量相似度计算 | < 1秒 | 每次推荐请求 |
| 并发用户 | 100+ | 无性能下降 |
| 向量更新延迟 | < 5分钟 | 资料更新到可用 |

### 3.2 安全需求

| 需求 | 实现方式 |
|------|----------|
| 数据加密 | HTTPS传输，AES-256加密存储 |
| 密码安全 | bcrypt哈希加盐，密码强度验证 |
| 认证机制 | JWT token + refresh token |
| 授权控制 | 基于角色的访问控制（RBAC） |
| 输入验证 | 服务端验证，防止SQL注入/XSS |
| 隐私保护 | 符合GDPR/CCPA要求 |

**安全约束**:
- 用户密码必须使用bcrypt或Argon2加密存储（参考real.md约束1）
- 用户个人资料、兴趣爱好等敏感信息必须加密存储和传输（参考real.md约束2）
- 匹配推荐算法必须考虑用户隐私设置（参考real.md约束3）

### 3.3 可用性需求

| 需求 | 目标 |
|------|------|
| 响应式设计 | 移动端优先，适配各种屏幕 |
| 可访问性 | WCAG 2.1 AA标准 |
| 浏览器支持 | 现代浏览器（Chrome/Safari/Firefox/Edge最近2年版本） |
| 多语言 | 中文（简体），后续支持英文 |
| 离线支持 | 基础功能离线浏览，数据需联网同步 |

### 3.4 可靠性需求

| 指标 | 目标 |
|------|------|
| 正常运行时间 | 99.5% |
| 恢复时间 | < 1小时 |
| 备份频率 | 每日自动备份 |
| 数据一致性 | 向量数据与用户资料保持一致 |
| 容错能力 | 单点故障不影响核心功能 |

## 4. 技术约束

### 4.1 前端技术栈

- **框架**: Next.js 15 + React 19
- **语言**: TypeScript
- **样式**: Tailwind CSS + shadcn/ui
- **状态管理**: Zustand
- **HTTP客户端**: Axios
- **认证**: Better Auth

### 4.2 后端技术栈

- **运行时**: Bun / Node.js 18+
- **API风格**: RESTful API
- **向量数据库**: Milvus
- **SDK**: Milvus Node.js SDK
- **AI集成**: Vercel AI SDK + OpenAI API
- **认证**: Better Auth

### 4.3 基础设施

- **托管**: Vercel
- **向量数据库**: Zilliz Cloud (Milvus托管)
- **CDN**: Vercel Edge Network
- **监控**: Vercel Analytics
- **日志**: 结构化日志记录

### 4.4 数据模型

**核心实体**（参考cog.md）:
- User: 用户（human_user）
- Profile: 用户资料（basic_info, interests, needs, provide）
- Match: 匹配关系
- IceBreaker: 破冰话题
- Preference: 用户偏好

## 5. 验收标准

### 5.1 核心功能验收

**用户注册登录 (P0)**:
- [ ] 新用户可以注册账户（邮箱验证）
- [ ] 用户可以使用邮箱密码登录
- [ ] 密码加密存储（bcrypt）
- [ ] 密码重置功能正常
- [ ] 登录状态保持7天

**用户资料管理 (P0)**:
- [ ] 用户可以完整填写个人资料
- [ ] 头像上传功能正常
- [ ] 资料修改后嵌入向量更新
- [ ] 隐私设置生效
- [ ] 必填字段验证正确

**AI匹配功能 (P0)**:
- [ ] 匹配推荐正常显示
- [ ] 匹配度计算准确
- [ ] 匹配原因清晰展示
- [ ] 刷新推荐功能正常
- [ ] 隐私设置影响推荐结果

**破冰话题生成 (P0)**:
- [ ] 话题自动生成
- [ ] 话题个性化程度高
- [ ] 重新生成功能正常
- [ ] 话题内容安全
- [ ] 收藏功能可用

### 5.2 集成验收

- [ ] 前后端API对接正常
- [ ] 向量数据库连接稳定
- [ ] AI服务调用成功
- [ ] 用户认证流程完整
- [ ] 数据加密传输正常

### 5.3 非功能验收

- [ ] 页面加载速度达标
- [ ] 安全测试通过
- [ ] 响应式设计适配
- [ ] 浏览器兼容性测试
- [ ] 性能压力测试通过

## 6. 范围外

以下功能暂不在本版本范围内：

- 实时聊天功能（后续版本）
- 群组匹配（后续版本）
- 高级筛选条件（年龄段、城市等精确筛选）
- 社交媒体登录（仅邮箱注册）
- 付费功能（免费版本）
- 视频/语音通话（后续版本）
- 地理位置精确匹配（仅城市级别）
- AI头像生成（使用用户上传头像）
- 数据导出为PDF报告
- 多端数据同步（先专注单端体验）

## 7. 假设与依赖

### 7.1 技术假设

- 用户设备支持现代浏览器
- 网络环境稳定，能够访问外部AI服务
- Zilliz Cloud服务稳定可用
- OpenAI API服务稳定

### 7.2 业务假设

- 用户愿意提供真实的个人资料
- 用户能够理解AI匹配的概念
- 用户对隐私保护有明确需求
- 内向者市场足够支撑产品发展

### 7.3 外部依赖

- Zilliz Cloud (Milvus) 向量数据库服务
- OpenAI API 用于AI功能
- Better Auth 认证服务
- Vercel 托管和部署服务

## 8. 风险与缓解

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| AI服务不稳定 | 中 | 高 | 多API备选，降级方案 |
| 向量数据库性能问题 | 中 | 高 | 定期优化，索引调优 |
| 用户隐私泄露 | 低 | 高 | 严格加密，审计日志 |
| 匹配质量不佳 | 中 | 中 | 持续优化算法，收集反馈 |
| 用户增长缓慢 | 中 | 中 | 精准营销，口碑传播 |

## 9. 附录

### 9.1 术语表

- **向量数据库**: 存储和查询高维向量的数据库，用于计算相似度
- **嵌入向量**: 将文本/图像等转换为数字向量表示
- **相似度计算**: 通过数学方法计算两个向量的相似程度
- **破冰话题**: 帮助陌生人开启对话的话题
- **内向者**: 倾向于从内部世界获取能量，偏好小群体互动的人群

### 9.2 参考文档

- 现实约束文档: `.42cog/real/real.md`
- 认知模型文档: `.42cog/cog/cog.md`
- 项目元信息: `.42cog/meta/meta.md`

### 9.3 更新记录

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|----------|------|
| 0.1.0 | 2025-12-24 | 初始版本，定义P0-P2功能需求 | 江浩 |
