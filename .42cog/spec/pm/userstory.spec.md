# 用户故事规格书：如故（as old）

**项目名称**: 如故（as old）
**版本**: 0.1.0
**创建日期**: 2025-12-24
**基于**: 三种最小故事框架（Light、Dark、Grey）

## 文档概述

本用户故事规格书基于产品需求文档（pr.spec.md）和认知敏捷法的三种最小故事框架编写，将产品功能转化为可执行的最小故事单元。

### 三种最小故事框架

- **Light Story（光明故事）**: 坏到好的转变，用户成长体验
- **Dark Story（黑暗故事）**: 正常到异常再到恢复，问题处理体验
- **Grey Story（灰色故事）**: 循环往复，日常使用体验

## 复杂故事概述

| 复杂故事 | 最小故事数量 | 优先级 | 故事类型分布 | 核心价值 |
|----------|--------------|--------|--------------|----------|
| CS-01: 用户入门流程 | 5 | P0 | Light 3, Dark 1, Grey 1 | 从陌生人到活跃用户 |
| CS-02: 个人资料管理 | 4 | P0 | Light 2, Dark 1, Grey 1 | 建立完整用户画像 |
| CS-03: 智能匹配发现 | 6 | P0 | Light 3, Dark 2, Grey 1 | 找到一见如故的朋友 |
| CS-04: 破冰话题互动 | 4 | P0 | Light 2, Dark 1, Grey 1 | 降低社交沟通门槛 |
| CS-05: 匹配关系管理 | 5 | P1 | Light 2, Dark 2, Grey 1 | 管理社交连接 |
| CS-06: 用户设置与偏好 | 4 | P1 | Light 2, Dark 1, Grey 1 | 个性化体验优化 |

---

## CS-01: 用户入门流程

**描述**: 新用户从访问网站到完成首次匹配推荐的全过程
**用户类型**: 新注册用户
**核心价值**: 让新用户快速体验产品核心价值

**故事类型分布**:
- Light Stories: 3个（用户成长）
- Dark Stories: 1个（问题处理）
- Grey Stories: 1个（日常使用）

**包含的最小故事**:
- MS-L-01: 用户注册
- MS-L-02: 首次登录
- MS-L-03: 完成个人资料
- MS-D-01: 登录失败处理
- MS-G-01: 查看主页

**用户旅程**: 访问首页 → 注册账户 → 登录系统 → 完善资料 → 查看匹配推荐

### MS-L-01: 用户注册

**复杂故事**: CS-01
**故事类型**: Light
**优先级**: P0
**故事点数**: 3

#### 用户故事
作为一个新用户，
我想注册一个账户，
以便能够使用如故的社交匹配功能。

#### 故事评估（Light Story）

**起始状态**: 用户没有账户，无法使用任何功能
**转折点**: 用户成功提交注册信息并验证邮箱
**结束状态**: 用户拥有有效账户，可以登录系统
**情感体验**: 从焦虑不安 → 满怀期待

#### 验收标准

- [ ] 用户可以使用邮箱和密码注册
- [ ] 密码使用bcrypt加密存储
- [ ] 注册成功后显示欢迎页面
- [ ] 系统发送验证邮件到注册邮箱
- [ ] 重复邮箱注册显示错误提示

#### 用户可感知变化

**操作前**: 看到登录/注册页面，需要创建账户
**操作中**: 填写邮箱、密码，点击注册按钮
**操作后**: 收到"注册成功"提示和验证邮件提醒

#### 约束（来自real.md）
- 用户密码必须使用bcrypt或Argon2加密存储（约束1）
- 用户个人资料、兴趣爱好等敏感信息必须加密存储和传输（约束2）

#### 依赖
- **需要**: 无
- **启用**: MS-L-02（首次登录）

---

### MS-L-02: 首次登录

**复杂故事**: CS-01
**故事类型**: Light
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个注册用户，
我想使用邮箱和密码登录系统，
以便能够访问个人资料和匹配功能。

#### 故事评估（Light Story）

**起始状态**: 用户有账户但未登录，无法访问功能
**转折点**: 输入正确凭据并通过身份验证
**结束状态**: 用户成功登录，进入系统主页
**情感体验**: 从门外汉 →  insiders

#### 验收标准

- [ ] 用户可以使用邮箱和密码登录
- [ ] 登录成功后跳转到主页
- [ ] 登录状态保持7天
- [ ] 错误密码显示友好错误信息
- [ ] 未注册邮箱登录显示引导注册

#### 用户可感知变化

**操作前**: 看到登录表单，需要输入凭据
**操作中**: 输入邮箱和密码，点击登录
**操作后**: 成功进入系统，看到欢迎信息

#### 约束
- 认证机制需要安全可靠
- 会话管理需要适当过期时间

#### 依赖
- **需要**: MS-L-01（用户注册）
- **启用**: MS-L-03（完成个人资料）

---

### MS-L-03: 完成个人资料

**复杂故事**: CS-01
**故事类型**: Light
**优先级**: P0
**故事点数**: 5

#### 用户故事
作为一个新登录用户，
我想填写完整的个人资料，
以便能够获得准确的匹配推荐。

#### 故事评估（Light Story）

**起始状态**: 用户资料空白，无法进行匹配
**转折点**: 用户填写关键信息并保存
**结束状态**: 资料完整，系统生成嵌入向量
**情感体验**: 从空白状态 → 完整身份

#### 验收标准

- [ ] 用户可以填写基本信息（姓名、年龄、城市）
- [ ] 用户可以添加多个兴趣爱好
- [ ] 用户可以描述自己的需求和供给
- [ ] 用户可以上传头像
- [ ] 资料修改后自动更新嵌入向量
- [ ] 必填字段验证提示清晰

#### 用户可感知变化

**操作前**: 看到资料不完整的提示
**操作中**: 逐步填写各个字段信息
**操作后**: 看到"资料完成度100%"，可查看匹配推荐

#### 约束
- 用户个人资料必须加密存储（约束2）
- 匹配推荐必须考虑隐私设置（约束3）

#### 依赖
- **需要**: MS-L-02（首次登录）
- **启用**: MS-G-02（查看匹配推荐）

---

### MS-D-01: 登录失败处理

**复杂故事**: CS-01
**故事类型**: Dark
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个登录用户，
当输入错误凭据时，
我希望系统提供清晰的错误提示，
以便我能够快速解决问题。

#### 故事评估（Dark Story）

**起始状态**: 用户尝试登录
**转折点**: 系统检测到凭据错误
**结束状态**: 用户获得明确提示并重试
**情感体验**: 从流畅 → 受阻 → 澄清

#### 验收标准

- [ ] 错误密码显示"密码错误"提示
- [ ] 未注册邮箱显示"邮箱未注册"提示
- [ ] 错误信息不泄露敏感信息
- [ ] 连续错误达到5次显示验证码
- [ ] 用户可以点击"忘记密码"链接

#### 用户可感知变化

**操作前**: 点击登录按钮
**操作中**: 系统验证凭据
**操作后**: 看到红色错误提示和解决建议

#### 约束
- 错误信息不能泄露系统信息
- 需要防止暴力破解攻击

#### 依赖
- **需要**: MS-L-02（首次登录）

---

### MS-G-01: 查看主页

**复杂故事**: CS-01
**故事类型**: Grey
**优先级**: P0
**故事点数**: 1

#### 用户故事
作为一个登录用户，
我想查看系统主页，
以便了解系统状态和可用功能。

#### 故事评估（Grey Story）

**循环模式**: 每次登录后查看主页
**优化点**: 快速加载，显示关键信息
**习惯形成**: 从新鲜 → 熟悉 → 自动化
**情感体验**: 从探索 → 习惯 → 流畅

#### 验收标准

- [ ] 主页加载时间 < 3秒
- [ ] 显示用户欢迎信息
- [ ] 显示匹配推荐数量
- [ ] 导航菜单清晰可见
- [ ] 快速访问核心功能入口

#### 用户可感知变化

**操作前**: 登录成功
**操作中**: 页面加载显示内容
**操作后**: 看到完整的主页界面

#### 约束
- 页面性能需要优化
- 用户数据需要安全加载

#### 依赖
- **需要**: MS-L-02（首次登录）

---

## CS-02: 个人资料管理

**描述**: 用户创建、编辑和完善个人资料的全过程
**用户类型**: 注册用户
**核心价值**: 建立准确完整的用户画像，为匹配提供基础

**故事类型分布**:
- Light Stories: 2个（用户成长）
- Dark Stories: 1个（问题处理）
- Grey Stories: 1个（日常使用）

**包含的最小故事**:
- MS-L-04: 编辑基本信息
- MS-L-05: 管理兴趣爱好
- MS-D-02: 头像上传失败处理
- MS-G-02: 查看个人资料

**用户旅程**: 填写资料 → 编辑信息 → 上传头像 → 预览资料 → 设置隐私

### MS-L-04: 编辑基本信息

**复杂故事**: CS-02
**故事类型**: Light
**优先级**: P0
**故事点数**: 3

#### 用户故事
作为一个用户，
我想随时编辑自己的基本信息，
以便保持资料的时效性和准确性。

#### 故事评估（Light Story）

**起始状态**: 基础信息过时或不准确
**转折点**: 用户修改信息并保存
**结束状态**: 信息更新，向量重新生成
**情感体验**: 从不满 → 掌控感 → 自豪

#### 验收标准

- [ ] 用户可以修改姓名、年龄、城市等信息
- [ ] 用户可以修改个人简介
- [ ] 修改后自动保存并显示成功提示
- [ ] 信息验证规则清晰明确
- [ ] 修改后匹配推荐自动更新

#### 用户可感知变化

**操作前**: 看到过时的或不准确的信息
**操作中**: 修改字段内容
**操作后**: 信息更新，看到匹配推荐变化

#### 约束
- 用户数据加密存储（约束2）
- 隐私设置影响信息展示（约束3）

#### 依赖
- **需要**: MS-L-03（完成个人资料）

---

### MS-L-05: 管理兴趣爱好

**复杂故事**: CS-02
**故事类型**: Light
**优先级**: P0
**故事点数**: 3

#### 用户故事
作为一个用户，
我想添加、删除或修改我的兴趣爱好，
以便获得更精准的匹配推荐。

#### 故事评估（Light Story）

**起始状态**: 兴趣爱好列表不完整或不准确
**转折点**: 用户调整兴趣爱好列表
**结束状态**: 兴趣爱好更新，匹配更精准
**情感体验**: 从模糊 → 清晰 → 认同感

#### 验收标准

- [ ] 用户可以添加新的兴趣爱好
- [ ] 用户可以删除不需要的兴趣爱好
- [ ] 支持文本输入或预设选择
- [ ] 兴趣爱好变更后嵌入向量自动更新
- [ ] 最多支持20个兴趣爱好

#### 用户可感知变化

**操作前**: 兴趣爱好列表
**操作中**: 添加、删除或修改兴趣
**操作后**: 列表更新，看到匹配推荐变化

#### 约束
- 兴趣爱好数据加密存储（约束2）
- 向量数据库定期更新验证（约束4）

#### 依赖
- **需要**: MS-L-03（完成个人资料）

---

### MS-D-02: 头像上传失败处理

**复杂故事**: CS-02
**故事类型**: Dark
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个用户，
当头像上传失败时，
我希望系统提供明确的错误原因，
以便我能够快速解决问题。

#### 故事评估（Dark Story）

**起始状态**: 用户尝试上传头像
**转折点**: 上传失败（格式错误/大小超限）
**结束状态**: 用户了解原因并成功上传
**情感体验**: 从期待 → 困惑 → 释然

#### 验收标准

- [ ] 文件格式错误显示"仅支持JPG/PNG格式"
- [ ] 文件过大显示"文件大小超过2MB限制"
- [ ] 网络错误显示"上传失败，请检查网络"
- [ ] 提供重新上传按钮
- [ ] 上传进度清晰可见

#### 用户可感知变化

**操作前**: 点击上传头像按钮
**操作中**: 文件选择和上传过程
**操作后**: 看到成功或失败的提示

#### 约束
- 头像文件需要安全存储
- 上传过程需要加密传输

#### 依赖
- **需要**: MS-L-04（编辑基本信息）

---

### MS-G-02: 查看个人资料

**复杂故事**: CS-02
**故事类型**: Grey
**优先级**: P0
**故事点数**: 1

#### 用户故事
作为一个用户，
我想查看完整的个人资料，
以便确认信息准确性和完整性。

#### 验收标准

- [ ] 资料页面完整显示所有信息
- [ ] 头像清晰可见
- [ ] 兴趣爱好以标签形式展示
- [ ] 可以快速编辑任何字段
- [ ] 资料完整度百分比显示

#### 约束
- 资料查看需要权限控制
- 私密信息不对外展示

#### 依赖
- **需要**: MS-L-04（编辑基本信息）

---

## CS-03: 智能匹配发现

**描述**: 用户获取AI推荐匹配用户的全过程
**用户类型**: 完整资料用户
**核心价值**: 找到真正匹配的朋友

**故事类型分布**:
- Light Stories: 3个（用户成长）
- Dark Stories: 2个（问题处理）
- Grey Stories: 1个（日常使用）

**包含的最小故事**:
- MS-L-06: 查看匹配推荐
- MS-L-07: 了解匹配原因
- MS-L-08: 刷新匹配推荐
- MS-D-03: 无匹配结果处理
- MS-D-04: 匹配算法异常处理
- MS-G-03: 浏览匹配历史

**用户旅程**: 进入匹配页 → 查看推荐列表 → 了解匹配原因 → 刷新推荐 → 查看历史

### MS-L-06: 查看匹配推荐

**复杂故事**: CS-03
**故事类型**: Light
**优先级**: P0
**故事点数**: 5

#### 用户故事
作为一个完整资料的用户，
我想查看AI推荐的匹配用户，
以便找到一见如故的朋友。

#### 故事评估（Light Story）

**起始状态**: 没有推荐或推荐过时
**转折点**: 系统计算并显示匹配结果
**结束状态**: 看到个性化推荐列表
**情感体验**: 从孤独 → 希望 → 兴奋

#### 验收标准

- [ ] 打开匹配页看到推荐列表
- [ ] 推荐列表按匹配度排序
- [ ] 显示推荐用户的基本信息
- [ ] 显示匹配度百分比
- [ ] 每个推荐显示匹配原因
- [ ] 匹配计算时间 < 2秒

#### 用户可感知变化

**操作前**: 匹配页面空白或加载中
**操作中**: 系统计算匹配度
**操作后**: 看到推荐用户列表和匹配度

#### 约束
- 匹配算法考虑隐私设置（约束3）
- 向量数据库准确性验证（约束4）

#### 依赖
- **需要**: MS-L-03（完成个人资料）

---

### MS-L-07: 了解匹配原因

**复杂故事**: CS-03
**故事类型**: Light
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个用户，
我想了解为什么推荐某个用户，
以便判断是否值得深入了解。

#### 故事评估（Light Story）

**起始状态**: 看到推荐但不知道原因
**转折点**: 点击查看匹配原因
**结束状态**: 理解共同点，增加信任
**情感体验**: 从好奇 → 理解 → 信任

#### 验收标准

- [ ] 点击推荐用户显示匹配原因
- [ ] 匹配原因基于共同兴趣/需求
- [ ] 原因描述清晰具体
- [ ] 显示共同点的具体内容
- [ ] 原因列表支持展开/收起

#### 用户可感知变化

**操作前**: 推荐用户卡片
**操作中**: 点击"匹配原因"按钮
**操作后**: 看到详细的共同点分析

#### 约束
- 匹配原因不能泄露私密信息
- 需要遵守隐私设置

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-L-08: 刷新匹配推荐

**复杂故事**: CS-03
**故事类型**: Light
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个用户，
我想刷新匹配推荐列表，
以便看到更多可能匹配的朋友。

#### 故事评估（Light Story）

**起始状态**: 当前推荐列表不感兴趣
**转折点**: 点击刷新按钮
**结束状态**: 看到新的推荐列表
**情感体验**: 从失望 → 期待 → 新鲜感

#### 验收标准

- [ ] 提供刷新按钮
- [ ] 刷新后生成新的推荐列表
- [ ] 刷新过程显示加载状态
- [ ] 避免推荐已被拒绝的用户
- [ ] 刷新间隔时间限制（避免频繁刷新）

#### 用户可感知变化

**操作前**: 当前推荐列表
**操作中**: 点击刷新按钮，显示加载
**操作后**: 看到新的推荐列表

#### 约束
- 向量计算需要资源优化
- 刷新频率需要限制

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-D-03: 无匹配结果处理

**复杂故事**: CS-03
**故事类型**: Dark
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个用户，
当没有找到匹配用户时，
我希望系统提供合理的建议和解决方案。

#### 故事评估（Dark Story）

**起始状态**: 用户期待看到匹配
**转折点**: 系统显示无匹配结果
**结束状态**: 用户获得改进建议
**情感体验**: 从期待 → 失望 → 指导

#### 验收标准

- [ ] 显示"暂无匹配用户"提示
- [ ] 提供可能原因说明（资料不完整/用户少等）
- [ ] 建议完善资料或等待新用户
- [ ] 提供返回或继续完善资料的链接
- [ ] 保持页面可用性，不显示空白

#### 用户可感知变化

**操作前**: 期待看到推荐
**操作中**: 系统搜索匹配
**操作后**: 看到友好提示和建议

#### 约束
- 需要保护用户隐私
- 不能泄露系统内部信息

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-D-04: 匹配算法异常处理

**复杂故事**: CS-03
**故事类型**: Dark
**优先级**: P0
**故事点数**: 3

#### 用户故事
当匹配算法出现异常时，
我希望系统能够优雅处理，
并提供替代解决方案。

#### 故事评估（Dark Story）

**起始状态**: 匹配功能正常
**转折点**: 算法异常或服务不可用
**结束状态**: 系统恢复或提供降级方案
**情感体验**: 从流畅 → 困惑 → 理解

#### 验收标准

- [ ] 显示友好的错误信息
- [ ] 提供稍后重试选项
- [ ] 记录错误日志用于调试
- [ ] 不暴露技术细节给用户
- [ ] 自动重试机制（可选）

#### 用户可感知变化

**操作前**: 正常访问匹配功能
**操作中**: 系统异常或错误
**操作后**: 看到错误提示和解决建议

#### 约束
- 错误处理需要安全可靠
- 不能泄露系统架构信息

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-G-03: 浏览匹配历史

**复杂故事**: CS-03
**故事类型**: Grey
**优先级**: P0
**故事点数**: 2

#### 用户故事
作为一个用户，
我想查看匹配历史记录，
以便回顾之前的推荐和互动。

#### 验收标准

- [ ] 显示历史匹配推荐列表
- [ ] 显示匹配时间和匹配度
- [ ] 支持按时间排序
- [ ] 可以快速重新查看详情
- [ ] 历史记录保留30天

#### 约束
- 历史数据需要安全存储
- 用户隐私数据保护

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

## CS-04: 破冰话题互动

**描述**: 基于匹配用户生成个性化破冰话题的全过程
**用户类型**: 看到匹配用户的用户
**核心价值**: 降低社交沟通门槛

**故事类型分布**:
- Light Stories: 2个（用户成长）
- Dark Stories: 1个（问题处理）
- Grey Stories: 1个（日常使用）

**包含的最小故事**:
- MS-L-09: 生成破冰话题
- MS-L-10: 保存喜欢的话题
- MS-D-05: 话题生成失败处理
- MS-G-04: 浏览话题历史

**用户旅程**: 选择匹配用户 → 生成破冰话题 → 浏览话题 → 保存喜欢的话题 → 查看历史

### MS-L-09: 生成破冰话题

**复杂故事**: CS-04
**故事类型**: Light
**优先级**: P0
**故事点数**: 3

#### 用户故事
作为一个用户，
我想为匹配的潜在朋友生成破冰话题，
以便更容易开启对话。

#### 故事评估（Light Story）

**起始状态**: 有匹配用户但不知道如何开始对话
**转折点**: AI生成个性化破冰话题
**结束状态**: 获得3-5个相关话题
**情感体验**: 从焦虑 → 安心 → 自信

#### 验收标准

- [ ] 选择匹配用户后自动生成话题
- [ ] 生成3-5个不同类型话题
- [ ] 话题类型包括：兴趣、经历、价值观、轻松话题
- [ ] 话题内容个性化，与双方信息相关
- [ ] 话题生成时间 < 3秒
- [ ] 话题内容安全，无不当内容

#### 用户可感知变化

**操作前**: 选择匹配用户
**操作中**: 系统生成破冰话题
**操作后**: 看到个性化话题列表

#### 约束
- 话题生成不得泄露私密信息（约束2）
- AI内容需要安全审核

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-L-10: 保存喜欢的话题

**复杂故事**: CS-04
**故事类型**: Light
**优先级**: P0
**故事点数**: 1

#### 用户故事
作为一个用户，
我想保存喜欢的破冰话题，
以便将来参考或重复使用。

#### 验收标准

- [ ] 每个话题有收藏按钮
- [ ] 收藏后显示已收藏状态
- [ ] 收藏列表可以查看
- [ ] 支持取消收藏
- [ ] 收藏状态实时保存

#### 用户可感知变化

**操作前**: 看到破冰话题
**操作中**: 点击收藏按钮
**操作后**: 按钮变为已收藏状态

#### 约束
- 收藏数据需要安全存储

#### 依赖
- **需要**: MS-L-09（生成破冰话题）

---

### MS-D-05: 话题生成失败处理

**复杂故事**: CS-04
**故事类型**: Dark
**优先级**: P0
**故事点数**: 2

#### 用户故事
当AI生成破冰话题失败时，
我希望系统提供替代方案，
以便继续使用匹配功能。

#### 验收标准

- [ ] 显示"话题生成失败"提示
- [ ] 提供重新生成按钮
- [ ] 提供通用话题模板（备选）
- [ ] 错误信息友好不技术化
- [ ] 支持反馈问题机制

#### 用户可感知变化

**操作前**: 期待生成话题
**操作中**: AI处理过程
**操作后**: 看到错误或替代方案

#### 约束
- 错误处理不能泄露AI模型信息

#### 依赖
- **需要**: MS-L-09（生成破冰话题）

---

### MS-G-04: 浏览话题历史

**复杂故事**: CS-04
**故事类型**: Grey
**优先级**: P0
**故事点数**: 1

#### 用户故事
作为一个用户，
我想查看之前生成的破冰话题，
以便回顾或重复使用。

#### 验收标准

- [ ] 显示历史生成的话题
- [ ] 按生成时间排序
- [ ] 显示关联的匹配用户
- [ ] 支持快速重新生成
- [ ] 历史记录保留30天

#### 约束
- 历史数据安全存储
- 用户隐私保护

#### 依赖
- **需要**: MS-L-09（生成破冰话题）

---

## CS-05: 匹配关系管理

**描述**: 用户管理匹配关系，包括感兴趣、拒绝、屏蔽等操作
**用户类型**: 活跃用户
**核心价值**: 建立和管理社交连接

**故事类型分布**:
- Light Stories: 2个（用户成长）
- Dark Stories: 2个（问题处理）
- Grey Stories: 1个（日常使用）

**包含的最小故事**:
- MS-L-11: 表达感兴趣
- MS-L-12: 拒绝匹配
- MS-D-06: 误操作撤销
- MS-D-07: 匹配状态同步问题
- MS-G-05: 管理匹配关系

**用户旅程**: 查看推荐 → 表达意向 → 等待回应 → 管理关系

### MS-L-11: 表达感兴趣

**复杂故事**: CS-05
**故事类型**: Light
**优先级**: P1
**故事点数**: 2

#### 用户故事
作为一个用户，
我想对推荐的用户表达感兴趣，
以便有机会建立连接。

#### 验收标准

- [ ] 提供"感兴趣"按钮
- [ ] 点击后显示确认状态
- [ ] 记录感兴趣行为
- [ ] 对方也感兴趣时通知双方
- [ ] 感兴趣记录可查看

#### 约束
- 隐私设置影响展示
- 用户数据加密存储

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-L-12: 拒绝匹配

**复杂故事**: CS-05
**故事类型**: Light
**优先级**: P1
**故事点数**: 1

#### 用户故事
作为一个用户，
我想拒绝不合适的推荐，
以便优化匹配体验。

#### 验收标准

- [ ] 提供"拒绝"按钮
- [ ] 拒绝后不再推荐该用户
- [ ] 记录拒绝行为
- [ ] 支持批量拒绝操作
- [ ] 拒绝记录可查看

#### 用户可感知变化

**操作前**: 看到推荐用户
**操作中**: 点击拒绝按钮
**操作后**: 用户从列表消失

#### 约束
- 拒绝数据需要存储用于优化算法

#### 依赖
- **需要**: MS-L-06（查看匹配推荐）

---

### MS-D-06: 误操作撤销

**复杂故事**: CS-05
**故事类型**: Dark
**优先级**: P1
**故事点数**: 2

#### 用户故事
当我误操作表达了兴趣或拒绝时，
我希望能够撤销操作，
以便修正错误。

#### 验收标准

- [ ] 提供撤销按钮（5秒内）
- [ ] 撤销后恢复原状态
- [ ] 撤销操作记录
- [ ] 超时后不可撤销
- [ ] 撤销确认提示

#### 用户可感知变化

**操作前**: 刚完成操作
**操作中**: 意识到误操作
**操作后**: 点击撤销，恢复原状态

#### 约束
- 撤销操作需要时间限制

#### 依赖
- **需要**: MS-L-11（表达感兴趣）或MS-L-12（拒绝匹配）

---

### MS-D-07: 匹配状态同步问题

**复杂故事**: CS-05
**故事类型**: Dark
**优先级**: P1
**故事点数**: 3

#### 用户故事
当匹配状态不同步时，
我希望系统能够正确处理，
并显示准确状态。

#### 验收标准

- [ ] 检测状态不一致
- [ ] 自动同步最新状态
- [ ] 显示准确匹配结果
- [ ] 处理并发操作冲突
- [ ] 提供手动刷新选项

#### 用户可感知变化

**操作前**: 看到错误状态
**操作中**: 系统同步状态
**操作后**: 看到正确状态

#### 约束
- 状态同步需要可靠机制

#### 依赖
- **需要**: MS-L-11（表达感兴趣）

---

### MS-G-05: 管理匹配关系

**复杂故事**: CS-05
**故事类型**: Grey
**优先级**: P1
**故事点数**: 2

#### 用户故事
作为一个用户，
我想管理所有的匹配关系，
以便清晰了解社交状态。

#### 验收标准

- [ ] 显示所有匹配历史
- [ ] 分类显示：感兴趣、已匹配、已拒绝
- [ ] 显示匹配时间和匹配度
- [ ] 支持搜索和筛选
- [ ] 支持批量操作

#### 约束
- 关系数据安全存储

#### 依赖
- **需要**: MS-L-11（表达感兴趣）

---

## CS-06: 用户设置与偏好

**描述**: 用户自定义应用设置和匹配偏好的过程
**用户类型**: 注册用户
**核心价值**: 个性化体验优化

**故事类型分布**:
- Light Stories: 2个（用户成长）
- Dark Stories: 1个（问题处理）
- Grey Stories: 1个（日常使用）

**包含的最小故事**:
- MS-L-13: 设置匹配偏好
- MS-L-14: 修改密码
- MS-D-08: 密码修改失败处理
- MS-G-06: 管理通知设置

**用户旅程**: 进入设置 → 配置偏好 → 修改密码 → 管理通知

### MS-L-13: 设置匹配偏好

**复杂故事**: CS-06
**故事类型**: Light
**优先级**: P1
**故事点数**: 2

#### 用户故事
作为一个用户，
我想设置匹配偏好，
以便获得更符合期望的推荐。

#### 验收标准

- [ ] 可以设置年龄段偏好
- [ ] 可以设置距离偏好
- [ ] 可以设置兴趣偏好
- [ ] 偏好设置实时生效
- [ ] 支持重置为默认设置

#### 约束
- 偏好设置影响匹配算法
- 设置需要加密存储

#### 依赖
- **需要**: MS-L-03（完成个人资料）

---

### MS-L-14: 修改密码

**复杂故事**: CS-06
**故事类型**: Light
**优先级**: P1
**故事点数**: 2

#### 用户故事
作为一个用户，
我想修改登录密码，
以便提高账户安全性。

#### 验收标准

- [ ] 验证原密码正确性
- [ ] 新密码强度验证
- [ ] 确认新密码输入
- [ ] 密码加密存储
- [ ] 修改成功后通知用户

#### 约束
- 密码必须使用bcrypt加密（约束1）
- 新密码需要强度验证

#### 依赖
- **需要**: MS-L-02（首次登录）

---

### MS-D-08: 密码修改失败处理

**复杂故事**: CS-06
**故事类型**: Dark
**优先级**: P1
**故事点数**: 1

#### 用户故事
当密码修改失败时，
我希望了解失败原因并能够重试。

#### 验收标准

- [ ] 原密码错误显示提示
- [ ] 新密码不符合要求显示要求
- [ ] 网络错误显示重试提示
- [ ] 提供重新尝试选项
- [ ] 不泄露敏感信息

#### 用户可感知变化

**操作前**: 输入新密码
**操作中**: 验证过程
**操作后**: 看到成功或失败提示

#### 约束
- 错误信息不能泄露系统信息

#### 依赖
- **需要**: MS-L-14（修改密码）

---

### MS-G-06: 管理通知设置

**复杂故事**: CS-06
**故事类型**: Grey
**优先级**: P1
**故事点数**: 1

#### 用户故事
作为一个用户，
我想管理通知偏好，
以便控制接收信息的频率和类型。

#### 验收标准

- [ ] 可以开启/关闭邮件通知
- [ ] 可以开启/关闭推送通知
- [ ] 可以设置通知频率
- [ ] 设置实时保存
- [ ] 可以一键重置所有设置

#### 约束
- 通知数据需要安全存储

#### 依赖
- **需要**: MS-L-02（首次登录）

---

## 故事地图

```
用户旅程: 注册 → 完善资料 → 智能匹配 → 破冰话题 → 管理关系

迭代 1 (MVP - P0):
├── CS-01: 用户入门流程
│   ├── MS-L-01: 用户注册 (Light)
│   ├── MS-L-02: 首次登录 (Light)
│   ├── MS-L-03: 完成个人资料 (Light)
│   ├── MS-D-01: 登录失败处理 (Dark)
│   └── MS-G-01: 查看主页 (Grey)
├── CS-02: 个人资料管理
│   ├── MS-L-04: 编辑基本信息 (Light)
│   ├── MS-L-05: 管理兴趣爱好 (Light)
│   ├── MS-D-02: 头像上传失败处理 (Dark)
│   └── MS-G-02: 查看个人资料 (Grey)
├── CS-03: 智能匹配发现
│   ├── MS-L-06: 查看匹配推荐 (Light)
│   ├── MS-L-07: 了解匹配原因 (Light)
│   ├── MS-L-08: 刷新匹配推荐 (Light)
│   ├── MS-D-03: 无匹配结果处理 (Dark)
│   ├── MS-D-04: 匹配算法异常处理 (Dark)
│   └── MS-G-03: 浏览匹配历史 (Grey)
└── CS-04: 破冰话题互动
    ├── MS-L-09: 生成破冰话题 (Light)
    ├── MS-L-10: 保存喜欢的话题 (Light)
    ├── MS-D-05: 话题生成失败处理 (Dark)
    └── MS-G-04: 浏览话题历史 (Grey)

迭代 2 (P1):
├── CS-05: 匹配关系管理
│   ├── MS-L-11: 表达感兴趣 (Light)
│   ├── MS-L-12: 拒绝匹配 (Light)
│   ├── MS-D-06: 误操作撤销 (Dark)
│   ├── MS-D-07: 匹配状态同步问题 (Dark)
│   └── MS-G-05: 管理匹配关系 (Grey)
└── CS-06: 用户设置与偏好
    ├── MS-L-13: 设置匹配偏好 (Light)
    ├── MS-L-14: 修改密码 (Light)
    ├── MS-D-08: 密码修改失败处理 (Dark)
    └── MS-G-06: 管理通知设置 (Grey)
```

## 实现建议

### 迭代 1 (MVP - 4周)

**目标**: 实现核心用户流程，从注册到首次匹配推荐
**重点**: Light Stories为主，建立用户信心

**故事类型分布**:
- Light Stories: 14个 (78%)
- Dark Stories: 6个 (22%)
- Grey Stories: 4个 (0%)

**预期用户价值**:
1. 用户可以完成注册和资料填写
2. 用户可以获得AI匹配推荐
3. 用户可以生成破冰话题
4. 用户可以浏览和使用所有核心功能

### 迭代 2 (3周)

**目标**: 完善用户体验，增加高级功能
**重点**: 错误处理和日常使用优化

**故事类型分布**:
- Light Stories: 4个 (50%)
- Dark Stories: 3个 (38%)
- Grey Stories: 1个 (12%)

**预期用户价值**:
1. 用户可以管理匹配关系
2. 用户可以自定义应用设置
3. 用户体验更加流畅可靠

## 测试指南

### 最小故事测试方法

**Light Stories测试**:
1. 验证用户价值实现
2. 确认情感体验转变
3. 检查功能完整性

**Dark Stories测试**:
1. 模拟各种异常情况
2. 验证错误处理机制
3. 确认用户引导清晰

**Grey Stories测试**:
1. 测试重复操作性能
2. 验证用户体验优化
3. 检查习惯形成支持

### 验收标准验证

每个最小故事的验收标准需要：
- 可通过自动化测试验证
- 用户可以直接感知
- 覆盖正常和异常情况
- 符合real.md约束
- 明确"完成"标准

### 测试优先级

1. **P0故事**: 必须全部通过测试才能发布
2. **P1故事**: 建议通过，但允许在后续版本修复
3. **P2故事**: 可选实现，用于优化体验

## 质量检查清单

- [ ] 所有核心功能都有对应的最小故事
- [ ] 每个最小故事遵循INVEST原则
- [ ] 故事类型分布合理（Light为主）
- [ ] 验收标准清晰可测试
- [ ] 依赖关系明确
- [ ] 故事大小适中（1-3天完成）
- [ ] 体现real.md约束
- [ ] 故事地图展示清晰用户旅程
- [ ] 每个故事有明确用户价值

## 附录：三种最小故事详解

### Light Story（光明故事）

**定义**: 用户从"不能做某事"到"能做某事"的转变
**情感体验**: 从困难到容易，从不理解到理解
**产品应用**: 注册登录、功能首次使用、技能提升
**开发重点**: 快速展示价值，建立用户信心

### Dark Story（黑暗故事）

**定义**: 用户从正常状态遇到问题到系统帮助恢复
**情感体验**: 从流畅到受阻再到帮助
**产品应用**: 错误处理、异常恢复、风险警告
**开发重点**: 优雅处理问题，提供清晰引导

### Grey Story（灰色故事）

**定义**: 用户反复进行的日常操作
**情感体验**: 从陌生到熟练到自动化
**产品应用**: 日常登录、常规查询、批量操作
**开发重点**: 优化效率，减少认知负担

---

**更新记录**:
| 版本 | 日期 | 更新内容 | 作者 |
|------|------|----------|------|
| 0.1.0 | 2025-12-24 | 基于三种最小故事框架生成初始用户故事 | 江浩 |
