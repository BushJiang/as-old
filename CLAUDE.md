# Claude Code 使用指南

## 个人环境信息

- 设备：搭载 Apple 芯片的 Mac 电脑
- Node.js 管理：通过 bun 进行安装管理
- Python 环境：通过 uv 配置
- Git代码托管平台：cnb.cool

## 全局使用指令

- 始终使用 uv 运行服务器，而不是直接使用 pip。
- 始终使用中文回复而不是英文。
- 始终使用中文记录 CLAUDE.md 文件和 README 文件。
- Claude.md、README.md、注释等内容，一律使用中文。
- 如果用户使用了库，请先了解库的版本号，然后再使用 MCP 服务器 context7 获取该版本的库的代码。避免因为版本号和用户使用的不一致，导致代码报错。
- 不要使用加粗标记 `**`。
- 在文档重构时，优先使用 Write 工具而非 Edit 工具，因为 Edit 要求 old_string 逐字精确匹配，空格和空行的手动复制误差会导致失败。大改动（>50行）推荐 Write 工具，小改动（<10行）推荐 Edit 工具。

## 项目协作说明

请确保所有后续沟通和回复都使用中文。本文件包含了在项目中与 Claude Code 交互的全局指令和个人环境配置。

---

## 技术栈决策

### 数据库方案

本项目采用 PostgreSQL + pgvector 扩展方案。

选择理由：

1. 单数据库架构
   - 不需要维护两个数据库
   - 降低运维复杂度
   - 数据一致性有保障

2. pgvector 性能
   - 对于 < 100万向量的规模，性能完全够用
   - 支持向量索引（IVFFlat、HNSW）
   - 可以与 SQL 查询结合，实现混合过滤

3. 功能完整
   - 支持 ACID 事务
   - 支持 JOIN、外键、约束
   - 无需额外学习向量数据库的查询语言

### 数据库选择讨论概要

经过对以下方案的讨论和对比：

方案A：本地 JSON 文件
- 缺点：安全风险高、并发问题、用户体验差
- 结论：不推荐

方案B：Milvus + Neon 双数据库
- 优点：Milvus 是专用向量数据库，超大规模性能好
- 缺点：架构复杂、运维成本高、对于项目规模过度设计
- 结论：不推荐当前阶段使用

方案C：PostgreSQL + pgvector（最终选择）
- 优点：
  - 单数据库架构，简单可靠
  - pgvector 性能对于项目规模完全足够
  - 支持完整的 SQL 功能
  - 运维简单，成本低
- 结论：采用此方案

行业最佳实践参考：
- 70% 的项目使用单数据库 + pgvector
- 使用 Milvus/Pinecone 通常是 > 100万向量的大型项目
- Airbnb、Tinder、Reddit 等公司早期都使用单数据库方案

### 嵌入模型选择

本项目采用 bge-m3 嵌入模型。

选择理由：

1. 多语言支持
   - 支持中文、英文、日文、韩文等多种语言
   - 适合项目的国际化需求

2. 性能优秀
   - MTEB 排行榜表现优异
   - 1024 维度，平衡了精度和性能

3. 开源免费
   - 无 API 调用成本
   - 可本地部署，数据隐私可控

### 向量规格

- 维度：1024（bge-m3）
- 数据类型：vector(1024)
- 索引类型：根据数据规模选择
  - < 10万：无需索引
  - 10万 - 100万：IVFFlat
  - > 100万：HNSW

---

## 项目架构

```
前端：Next.js
  ├─ Zustand（状态管理）
  └─ shadcn/ui（UI 组件）

数据库：Neon PostgreSQL
  ├─ pgvector 扩展（向量搜索）
  ├─ NextAuth.js（认证）
  └─ Drizzle ORM / Prisma

嵌入模型：bge-m3
  ├─ 维度：1024
  └─ 部署方式：本地 Python 服务 / API
```

---

## 相关文档

- 数据流动文档：/docs/DATA_FLOW.md
